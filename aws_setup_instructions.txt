### Deploying Nginx on AWS EC2

Assuming you have an EC2 instance (e.g., running Amazon Linux 2, Ubuntu, or RHEL):

**1. Connect to your EC2 Instance:**
   Use SSH to connect to your EC2 instance.
   `ssh -i /path/to/your-key-pair.pem ec2-user@your-ec2-public-ip`
   (Replace `ec2-user` with `ubuntu` for Ubuntu instances, or `centos` for CentOS/RHEL.)

**2. Install Nginx:**

   *   **For Amazon Linux 2 / RHEL / CentOS:**
      ```bash
      sudo yum update -y
      sudo amazon-linux-extras install nginx1 -y # For Amazon Linux 2
      # OR: sudo yum install nginx -y # For RHEL/CentOS
      ```

   *   **For Ubuntu:**
      ```bash
      sudo apt update -y
      sudo apt install nginx -y
      ```

**3. Start Nginx Service:**
   ```bash
   sudo systemctl start nginx
   sudo systemctl enable nginx # Ensures Nginx starts on boot
   ```
   You can verify Nginx is running by navigating to your EC2 instance's public IP in a web browser. You should see the Nginx welcome page.

**4. Create Nginx Configuration File:**
   *   Create a new configuration file for your domain. Replace `your_domain.conf` with a meaningful name like `nageshwaramtrust.org.conf`.
      ```bash
      sudo nano /etc/nginx/sites-available/nageshwaramtrust.org.conf
      ```
   *   Paste the Nginx configuration into this file (ensure to replace `nageshwaramtrust.org.crt` and `.key` paths if you are manually adding them, but Certbot will handle this):
      ```nginx
      server {
          listen 80;
          server_name nageshwaramtrust.org www.nageshwaramtrust.org;

          return 301 https://$host$request_uri;
      }

      server {
          listen 443 ssl;
          server_name nageshwaramtrust.org www.nageshwaramtrust.org;

          # Placeholder for SSL certificates - Certbot will fill these
          ssl_certificate /etc/nginx/ssl/nageshwaramtrust.org.crt; # Certbot will create and link these
          ssl_certificate_key /etc/nginx/ssl/nageshwaramtrust.org.key; # Certbot will create and link these

          ssl_session_cache shared:SSL:10m;
          ssl_session_timeout 10m;
          ssl_protocols TLSv1.2 TLSv1.3;
          ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";
          ssl_prefer_server_ciphers on;

          # Example static file root (adjust as needed for your frontend files)
          root /var/www/nageshwaramtrust.org/html;
          index index.html index.htm;

          location / {
              try_files $uri $uri/ =404;
          }

          # (Optional) Example for API proxy, uncomment and configure if needed
          # location /api/ {
          #     proxy_pass http://localhost:3001;
          #     proxy_http_version 1.1;
          #     proxy_set_header Upgrade $http_upgrade;
          #     proxy_set_header Connection 'upgrade';
          #     proxy_set_header Host $host;
          #     proxy_cache_bypass $http_upgrade;
          # }
      }
      ```
   *   Save and exit the editor (Ctrl+X, Y, Enter for `nano`).

**5. Enable the Nginx Configuration:**
   *   Create a symbolic link from `sites-available` to `sites-enabled`.
      ```bash
      sudo ln -s /etc/nginx/sites-available/nageshwaramtrust.org.conf /etc/nginx/sites-enabled/
      ```
   *   Remove the default Nginx configuration to avoid conflicts:
      ```bash
      sudo rm /etc/nginx/sites-enabled/default
      ```

**6. Test Nginx Configuration and Reload:**
   ```bash
   sudo nginx -t # Tests the configuration for syntax errors
   sudo systemctl reload nginx # Reloads Nginx to apply the new configuration
   ```

**7. Configure EC2 Security Group:**
   *   In the AWS EC2 console, go to "Security Groups" and select the security group associated with your EC2 instance.
   *   **Inbound Rules:**
      *   Add a rule for **HTTP (Port 80)** from `Anywhere` (0.0.0.0/0).
      *   Add a rule for **HTTPS (Port 443)** from `Anywhere` (0.0.0.0/0).

---

### **Setting up SSL with Certbot on EC2 (for Nginx)**

Before starting these steps, ensure:
*   You have an **Elastic IP** associated with your EC2 instance.
*   Your **Route 53 DNS records are pointing your domain (e.g., `nageshwaramtrust.org` and `www.nageshwaramtrust.org`) to this Elastic IP**.

**1. Install Certbot and the Nginx Plugin:**

   *   **Connect to your EC2 instance via SSH.**

   *   **For Amazon Linux 2 / RHEL / CentOS:**
      ```bash
      sudo yum update -y
      sudo yum install -y epel-release
      sudo yum install -y certbot python3-certbot-nginx
      ```

   *   **For Ubuntu:**
      ```bash
      sudo apt update -y
      sudo apt install -y certbot python3-certbot-nginx
      ```

**2. Obtain and Install SSL Certificate:**

   *   Run Certbot. It will detect your Nginx configuration and attempt to obtain and install the certificate.
      ```bash
      sudo certbot --nginx -d nageshwaramtrust.org -d www.nageshwaramtrust.org
      ```
   *   **Follow the prompts:**
      *   Enter an email address for urgent renewal notices.
      *   Agree to the terms of service.
      *   Decide if you want to share your email with the Electronic Frontier Foundation (EFF).
      *   Certbot will ask if you want to redirect HTTP traffic to HTTPS. **Choose 2 (Redirect)**.

**3. Verify Automatic Renewal:**

   *   Test the renewal process without actually renewing (dry run):
      ```bash
      sudo certbot renew --dry-run
      ```
   *   If this command runs without errors, your certificates should automatically renew before they expire.